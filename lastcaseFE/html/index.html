<!DOCTYPE html>
<html lang="en" e.g.single post post-1234>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../css/login.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

</head>
<body>
<div class="navbar">
    <div class="nav_left">
        <span onclick="loadBlog()">Home</span>
        <span onclick="loadMyBlog()">My Blog</span>
        <span onclick="myProfile()">Profile</span>
    </div>
    <div class="nav_right" id="nav_right">

    </div>
</div>
<hr>
<div class="container" id="form_login">
</div>
<div class="body" id="body"></div>
<script>
    $(document).ready(function () {
        $(".container").fadeIn(1000);
        $(".s2class").css({"color": "#EE9BA3"});
        $(".s1class").css({"color": "#748194"});
        $(".signin").css({"display": "none"});
        $(".signup").css({"display": ""});
    });

    function loadRight(){
        let usn = localStorage.getItem('username');
        if(usn != null){
            let str = `<div class="usn_text">Hi, `+usn+`</div>`
            document.getElementById('nav_right').innerHTML = str;
            loadBlog();
        }
        else{
            let str = `<button class="btn_login" onclick="formsignin()">Sign In/Sign Up</button>`
            document.getElementById('nav_right').innerHTML = str;
        }
    }
    loadRight()
    function formsignup() {
        let str = `<div class="c1">

        <div class="c11">
            <h1 class="mainhead">PICK YOUR SPOT</h1>
            <p class="mainp">Just click the buttons below to toggle between SignIn & SignUp</p>
        </div>
        <div id="left" onclick="formsignin()"><h1 class="s1class"><span>SIGN</span><span class="su">IN</span>
        </h1></div>
        <div id="right" onclick="formsignup()"><h1 class="s2class"><span>SIGN</span><span class="su">UP</span></h1>
        </div>
        </div>
        <div class="c2">
        <div class="signup">
            <h1 class="signup1">SIGN UP</h1>
            <br><br><br><br>
            <input name="username" type="text" placeholder="Username*" id="username"  class="username"/>

            <input name="name" type="text" placeholder="Name*" id="name" class="username"/>

            <input name="password" type="password" placeholder="Password*" id="password" class="username"/>

            <button class="btn" onclick="save()">Sign Up</button>
        </div>
        </div>
        `
        document.getElementById('form_login').innerHTML = str;
    }

    function formsignin() {
        document.getElementById('body').innerHTML = '';
        let str = `
               <div class="c1">

        <div class="c11">
            <h1 class="mainhead">PICK YOUR SPOT</h1>
            <p class="mainp">Just click the buttons below to toggle between SignIn & SignUp</p>
        </div>
        <div id="left" onclick="formsignin()"><h1 class="s1class"><span>SIGN</span><span class="su">IN</span>
        </h1></div>
        <div id="right" onclick="formsignup()"><h1 class="s2class"><span>SIGN</span><span class="su">UP</span></h1>
        </div>
        </div>
        <div class="c2">
            <div class="signin">

            <h1 class="signup1">SIGN IN</h1>
            <br><br><br><br>
            <input name="username" type="text" placeholder="Username*" class="username" id="usn"/>

            <input name="password" type="password" placeholder="Password*" class="username" id="pass"/>

            <button class="btn" onclick="login()">Get Started</button>

            <br><br><br><br>
            <a href=""><p class="signup2">Forget Password?</p></a>
        </div>
        </div>
        `
        document.getElementById('form_login').innerHTML = str;
    }

    const API_URl = 'http://localhost:8080/users'


    function save() {
        let data = {
            username: document.getElementById('username').value,
            password: document.getElementById('password').value,
            name: document.getElementById('name').value
        }
        axios.post(API_URl + "/register", data).then(res => {
            alert("Đăng Kí Thành Công!")
        })
        formsignin();
    }

    function login() {
        let data = {
            username: document.getElementById('usn').value,
            password: document.getElementById('pass').value
        }
        axios.post(API_URl + "/login", data).then(res => {
            alert("Đăng Nhập Thành Công!")
            localStorage.setItem('username', document.getElementById('usn').value)
            let user = res.data;
            localStorage.setItem('id', user.id);
            document.getElementById('form_login').innerHTML = '';
            loadBlog();
            loadRight()
        })
    }

    function loadBlog() {
        axios.get('http://localhost:8080/blogs').then((res) =>{
            let list = res.data;
            let str = '<div class="list">'
            for (const blog of list)    {
                str += `<div class="list-item">
                        <img src="${blog.image}">
                        <h2>${blog.title}</h2>
                        <p>${blog.content}</p>
                        </div>
                    `
            }
            str += '</div>'
            document.getElementById('body').innerHTML = str;
        })
    }
    function loadMyBlog() {
        let id = localStorage.getItem('id');
        axios.get('http://localhost:8080/blogs/users/' + id).then(res =>{
            let list = res.data;
            console.log(list)
            let str = '<center><button class="btn-primary" onclick="showFormAddBlog()">Add New Blog</button></center>' +
                '<div class="list">'
            for (let i = 0; i < list.length; i++) {
                str += `<div class="list-item">
                        <img src="${list[i].image}">
                        <h2>${list[i].title}</h2>
                        <p>${list[i].content}</p>
                        <button class="btn-primary" onclick="showFormEditBlog(`+ list[i].id +`)">Edit</button>
                        <button class="btn-primary" onclick="deleteBlog(`+ list[i].id +`)">Delete</button>
                        </div>
                    `
            }
            str += '</div>'
            document.getElementById('body').innerHTML = str;
        })
    }
    function showFormAddBlog() {
        let str = `
        <div class="formAdd">
            <div class="title"><span>Title:</span> <input type="text" id="title" placeholder="Title"></div>
            <div class="title"><span>Content:</span> <input type="text" id="content" placeholder="Content"></div>
            <div class="title"><span>Image:</span> <input type="text" id="image" placeholder="Image"></div>
            <button class="btn-primary" onclick="addBlog()">Save</button>
        </div>
        `
        document.getElementById('body').innerHTML = str;
    }
    function addBlog(){
        let data = {
            title : document.getElementById('title').value,
            content : document.getElementById('content').value,
            image : document.getElementById('image').value,
            user : {
                id : localStorage.getItem('id')
            }
        }
        axios.post('http://localhost:8080/blogs', data).then(res =>{
            alert("Thêm Thành Công!");
            loadMyBlog();
        })
    }
    function myProfile() {
        let id = localStorage.getItem('id');
        axios.get('http://localhost:8080/users/' + id).then(res =>{
            let user = res.data;
            let str = `<div class="signup">
            <h1 class="signup1">My Profile</h1>
            <br><br><br><br>
            <input name="name" type="text" placeholder="Name*" id="name" class="username" value="${user.name}">

            <input name="username" type="text"  id="username"  class="username" value="${user.username}">

            <input name="password" type="password" placeholder="Password*" id="password" class="username" value="${user.password}">

            <button class="btn" onclick="saveProfile()">Save</button>
        </div>
            `
            document.getElementById('body').innerHTML = str;
        })
    }
    function saveProfile(){
        let id = localStorage.getItem('id');
        let data = {
            username : document.getElementById('username').value,
            name : document.getElementById('name').value,
            password : document.getElementById('password').value
        }
        axios.put('http://localhost:8080/users/' + id, data).then(res =>{
            alert("Sửa Thành Công!");
            loadBlog();
        })
    }
    function showFormEditBlog(id){
        console.log(id);
        axios.get('http://localhost:8080/blogs' + id).then(res =>{
            let blog = res.data;
            let str = `
        <div class="formAdd">
            <div class="title"><span>Title:</span> <input type="text" id="title" placeholder="Title" value="${blog.title}"></div>
            <div class="title"><span>Content:</span> <input type="text" id="content" placeholder="Content" value="${blog.content}></div>
            <div class="title"><span>Image:</span> <input type="text" id="image" placeholder="Image" value="${blog.image}></div>
            <button class="btn-primary" onclick="editBlog()">Save</button>
        </div>
        `
            document.getElementById('body').innerHTML = str;
        })

    }
    function deleteBlog(){

    }
</script>
</body>
</html>